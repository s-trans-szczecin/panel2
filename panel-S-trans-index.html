<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>S-TRANS | Fleet OS</title>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI;background:#0b0f1a;color:#fff;font-size:12px;overflow:hidden}

/* INTRO */
#intro{position:fixed;inset:0;background:black;z-index:3000}
#intro video{width:100%;height:100%;object-fit:cover}

/* LOGIN */
#login{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#000}
#loginBox{width:320px;background:#111;padding:24px;border-radius:14px;box-shadow:0 0 30px #39ff14}
#loginBox input,#loginBox button{width:100%;padding:8px;margin-top:8px}
#loginBox button{background:#39ff14;border:none;font-weight:bold}

/* PANEL */
#panel{display:none;height:100vh;flex-direction:column}

/* TOP */
#topbar{height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:#0a1428}
#logo{font-size:20px;font-weight:900;letter-spacing:3px}
#logo span{color:#39ff14;animation:spin 8s linear infinite}
@keyframes spin{from{transform:rotateY(0)}to{transform:rotateY(360deg)}}

/* KPI */
#kpi{display:flex;gap:4px;padding:4px}
.kpi{flex:1;background:#0f1629;border-radius:8px;padding:4px;text-align:center}
.kpi b{color:#39ff14}

/* MAIN */
#main{flex:1;display:grid;grid-template-columns:1.3fr 1fr;gap:6px;padding:6px;min-height:0}

/* BOX */
.box{background:rgba(15,22,41,.92);border-radius:8px;padding:10px;overflow:auto;border:1px solid rgba(255,255,255,.08);box-shadow:0 0 20px rgba(0,0,0,.4)}
h4{margin:2px 0 8px;color:#b6ffb0;font-size:13px}

/* TABLE */
table{width:100%;border-collapse:collapse}
th,td{padding:6px;border-bottom:1px solid rgba(255,255,255,.12);font-size:12px}
th{color:#b6ffb0;text-align:left}

/* BUTTONS */
button.small{font-size:11px;padding:4px 8px;border:none;border-radius:6px;cursor:pointer;transition:transform .1s ease}
button.small:hover{transform:scale(1.03)}
button.edit{background:#39ff14;color:#000}
button.del{background:#ff4444;color:#fff}

/* MAP */
#map{height:100%;border-radius:8px;border:1px solid rgba(255,255,255,.12)}

/* DOC MENU */
.docMenu{position:absolute;background:rgba(10,16,28,.95);border:1px solid rgba(57,255,20,.25);border-radius:8px;padding:6px;display:none;z-index:10;box-shadow:0 0 18px rgba(57,255,20,.25)}
.docMenu a{display:block;color:#fff;text-decoration:none;padding:4px 6px;border-radius:6px;margin:2px 0;font-size:12px}
.docMenu a:hover{background:rgba(57,255,20,.12)}
.docCell{position:relative}

/* SYSTEM */
.fuelBar{width:70px;height:8px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.08);border-radius:4px;display:inline-block;margin-right:6px;vertical-align:middle;overflow:hidden}
.fuelBar div{height:100%;background:linear-gradient(90deg,#39ff14,#b6ffb0)}
.alert{padding:2px 6px;border-radius:6px;font-weight:700;text-align:center;display:inline-block}
.alert.green{background:rgba(57,255,20,.18);border:1px solid rgba(57,255,20,.35);color:#b6ffb0}
.alert.red{background:rgba(255,75,75,.18);border:1px solid rgba(255,75,75,.35);color:#ffb0b0}
.dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin:0 3px;vertical-align:middle}
.dot.green{background:#39ff14;box-shadow:0 0 6px rgba(57,255,20,.7)}
.dot.red{background:#ff4b4b;box-shadow:0 0 6px rgba(255,75,75,.7)}
</style>
</head>

<body>

<div id="intro">
  <video id="introVideo" autoplay muted>
    <source src="intro.mp4" type="video/mp4">
  </video>
</div>

<div id="login">
  <div id="loginBox">
    <h3>Logowanie</h3>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Has≈Ço">
    <button id="loginBtn">Zaloguj</button>
    <p id="loginError"></p>
  </div>
</div>

<div id="panel">

  <div id="topbar">
    <div id="logo"><span>S</span>-TRANS</div>
    <button onclick="logout()" class="small del">Wyloguj</button>
  </div>

  <div id="kpi">
    <div class="kpi">Zlecenia<br><b id="kpiOrders">0</b></div>
    <div class="kpi">Kierowcy<br><b id="kpiDrivers">0</b></div>
    <div class="kpi">Online<br><b id="kpiOnline">0</b></div>
  </div>

  <div id="main">

    <!-- LEFT: ORDERS + DRIVERS -->
    <div class="box" style="display:grid;grid-template-rows:1fr 1fr;gap:6px;min-height:0">

      <div style="overflow:auto">
        <h4>üì¶ Zlecenia</h4>
        <button class="small" style="margin-bottom:6px" onclick="addOrder()">‚ûï Dodaj zlecenie</button>
        <table id="ordersTable"></table>
      </div>

      <div style="overflow:auto">
        <h4>üöö Kierowcy</h4>
        <table id="driversTable">
          <tr>
            <th>Kierowca</th><th>Nr rej</th><th>Data przeglƒÖdu</th><th>≈Åadowno≈õƒá</th><th>HDS</th><th>Dokumenty</th>
          </tr>
        </table>
      </div>

    </div>

    <!-- RIGHT: MAP + SYSTEM -->
    <div style="display:grid;grid-template-rows:1fr 1fr;gap:6px;min-height:0">

      <div class="box" style="min-height:0">
        <h4>üó∫Ô∏è Mapa</h4>
        <div id="map"></div>
      </div>

      <div class="box" style="min-height:0">
        <h4>üñ•Ô∏è System</h4>
        <table>
          <tr><th>GPS</th><th>Paliwo</th><th>ETA</th><th>Alert</th><th>Czat / Kamera</th></tr>
          <tbody id="systemRows"></tbody>
        </table>
      </div>

    </div>

  </div>
</div>

<!-- MODAL -->
<div id="modal">
  <div id="modalBox">
    <h4>Edycja zlecenia</h4>
    <input id="editTitle" placeholder="Tytu≈Ç">
    <input id="editStatus" placeholder="Status">
    <button onclick="saveOrder()" class="small edit">Zapisz</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAqm4Z8xeZ1mYelt4giRQknCWG6RMzAs8c",
  authDomain:"fir-trans-projekt.firebaseapp.com",
  databaseURL:"https://fir-trans-projekt-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"fir-trans-projekt"
});

const auth=firebase.auth();
const db=firebase.database();
let currentOrderId=null;
let map, cars=[];

setTimeout(()=>{
  intro.style.display="none";
  login.style.display="flex";
},4000);

loginBtn.onclick=()=>{
  auth.signInWithEmailAndPassword(email.value,password.value)
  .then(()=>{
    login.style.display="none";
    panel.style.display="flex";
    initMap();
    loadOrders();
    loadDrivers();
    loadSystem();
  })
  .catch(e=>loginError.innerText=e.message);
};

function initMap(){
  map = L.map("map").setView([53.4,14.55],10);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

  const carIcon = L.icon({
    iconUrl:'https://cdn-icons-png.flaticon.com/512/744/744465.png',
    iconSize:[20,20]
  });

  for(let i=0;i<10;i++){
    const marker = L.marker([53.43 + i*0.02, 14.55 + i*0.01], {icon:carIcon}).addTo(map);
    cars.push(marker);
  }

  setInterval(()=>{
    cars.forEach(m=>{
      const p=m.getLatLng();
      m.setLatLng([p.lat + (Math.random()-0.5)*0.01, p.lng + (Math.random()-0.5)*0.01]);
    });
  },1500);
}

function loadOrders(){
  db.ref("orders").on("value",snap=>{
    ordersTable.innerHTML =
      "<tr><th>ID</th><th>Tytu≈Ç</th><th>Status</th><th>Akcje</th></tr>";
    let c=0;
    snap.forEach(o=>{
      c++;
      ordersTable.innerHTML+=`
      <tr>
        <td>${o.key}</td>
        <td>${o.val().title||""}</td>
        <td>${o.val().status||""}</td>
        <td>
          <button class="small edit" onclick="editOrder('${o.key}','${o.val().title}','${o.val().status}')">‚úè</button>
          <button class="small del" onclick="deleteOrder('${o.key}')">üóë</button>
        </td>
      </tr>`;
    });
    kpiOrders.innerText=c;
  });
}

function addOrder(){
  const id = "ZL-"+Math.floor(Math.random()*900+100);
  db.ref("orders/"+id).set({
    title:"Nowe zlecenie",
    status:"Nowe"
  });
}

function editOrder(id,title,status){
  currentOrderId=id;
  editTitle.value=title;
  editStatus.value=status;
  modal.style.display="flex";
}

function saveOrder(){
  db.ref("orders/"+currentOrderId).update({
    title:editTitle.value,
    status:editStatus.value
  });
  modal.style.display="none";
}

function deleteOrder(id){
  if(confirm("UsunƒÖƒá zlecenie?")){
    db.ref("orders/"+id).remove();
  }
}

function loadDrivers(){
  const drivers = [
    {name:"Jan Kowalski", reg:"ZS12345", check:"2026-03-12", load:"1200kg", hds:"TAK"},
    {name:"Anna Nowak", reg:"ZS54321", check:"2026-04-02", load:"1500kg", hds:"NIE"},
    {name:"Marek Wi≈õniewski", reg:"ZS11122", check:"2026-02-15", load:"900kg", hds:"TAK"}
  ];

  driversTable.innerHTML =
    "<tr><th>Kierowca</th><th>Nr rej</th><th>Data przeglƒÖdu</th><th>≈Åadowno≈õƒá</th><th>HDS</th><th>Dokumenty</th></tr>";

  drivers.forEach(d=>{
    const row = driversTable.insertRow();
    row.innerHTML = `
      <td>${d.name}</td>
      <td>${d.reg}</td>
      <td>${d.check}</td>
      <td>${d.load}</td>
      <td>${d.hds}</td>
      <td class="docCell">
        <button class="small" onclick="toggleDocs(this)">Wy≈õlij</button>
        <div class="docMenu">
          <a href="#">Faktura</a>
          <a href="#">WZ</a>
          <a href="#">List przewozowy</a>
          <a href="#">Dokumentacja przewozu</a>
          <a href="#">Dokumentacja zlecenia</a>
          <a href="#">Dokumentacja dla klienta</a>
        </div>
      </td>
    `;
  });

  kpiDrivers.innerText = drivers.length;
}

function toggleDocs(btn){
  const menu = btn.nextElementSibling;
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function loadSystem(){
  systemRows.innerHTML="";
  for(let i=0;i<10;i++){
    const tr=document.createElement("tr");
    tr.innerHTML = `
      <td>53.${40+i} / 14.${50+i}</td>
      <td><div class="fuelBar"><div style="width:${30+i*6}%"></div></div>${30+i*6} L</td>
      <td>ETA ${14+i}:30</td>
      <td class="alert ${i%3==0?'green':'red'}">${i%3==0?'OK':'ALERT'}</td>
      <td>üé• <span class="dot ${i%2==0?'green':'red'}"></span> üí¨ <span class="dot ${i%2==1?'green':'red'}"></span></td>
    `;
    systemRows.appendChild(tr);
  }
}

function logout(){
  auth.signOut().then(()=>location.reload());
}
</script>

</body>
</html>
